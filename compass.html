<!DOCTYPE html>
<html>
<head>
<title>Simple Compass (jQuery - Debug)</title>
<style>
  #compass-data {
    font-size: 2em;
    text-align: center;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #debug-info {
    font-size: 0.8em;
    margin-top: 10px;
    color: gray;
  }
</style>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>

<div id="compass-data">Waiting for compass data...</div>
<div id="debug-info"></div>

<script>
  $(document).ready(function() {
    const $compassDataDiv = $('#compass-data');
    const $debugInfoDiv = $('#debug-info');

    function updateCompass(event) {
      $debugInfoDiv.text(`Raw Event Data: ${JSON.stringify(event)}`); // Log the entire event

      let heading = event.alpha || event.webkitCompassHeading;

      if (typeof heading === 'number' && !isNaN(heading)) {
        heading = Math.round(heading);
        const direction = getDirection(heading);
        $compassDataDiv.html(`${heading}&deg; ${direction}`);
      } else {
        $compassDataDiv.text('Invalid compass data received.');
        console.warn('Invalid heading:', heading, 'Event:', event); // Log the invalid heading
      }
    }

    function getDirection(degrees) {
      const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
      const index = Math.round(degrees / 22.5) % 16;
      return directions[index];
    }

    if ('ondeviceorientationabsolute' in window) {
      $(window).on('deviceorientationabsolute', function(event) {
        updateCompass(event.originalEvent); // Access the original event object
      });
    } else if ('ondeviceorientation' in window) {
      $(window).on('deviceorientation', function(event) {
        updateCompass(event.originalEvent); // Access the original event object
      });
    } else {
      $compassDataDiv.text('Device orientation not supported.');
    }
  });
</script>

</body>
</html>
